<?xml version="1.0" encoding="utf-8" ?>
<c:Screen xmlns:c="BitMobile.Controls" xmlns:s="BitMobile.ValueStack" xmlns:d="DefaultScope">

  <s:Push Id="outlet" Value="$param1"></s:Push>
  <s:Push Id="workflow.outlet" Value="$outlet"></s:Push>
  <s:Push Id="executedOrder" Value="$param3"></s:Push>
  <s:Push Id="priceLists" Value="$Facade.GetPriceListQty($outlet.Id)"></s:Push>

  <s:Push Id="workflow.order" Value ="$Facade.CreateOrderIfNotExists($workflow.order, $outlet, $common.UserId, $workflow.visit.Id, $executedOrder, $priceLists)"></s:Push>

  <s:Push Id="items" Value="$Facade.GetOrderedSKUs($workflow.order.Id)"></s:Push>
  <s:Push Id="qty" Value="$Facade.GetOrderQTY($workflow.order.Id)"></s:Push>
  <s:Push Id="sum" Value="$Facade.GetOrderSUM($workflow.order.Id)"></s:Push>
  <s:Push Id="maxAmount" Value="$Facade.GetMaxOrderAmount($workflow.order.OutletAsObject)"></s:Push>
  <s:Push Id="greater" Value="$Facade.GetGreater($sum,$maxAmount)"></s:Push>
  <s:Push Id="null" Value="$Facade.CreateOrderStatusVariables()"></s:Push>

  <c:DockLayout>

    <c:DockLayout CssClass="top_navigator">
      <c:HorizontalLayout CssClass="btn_back" OnEvent="Back" OnClickAction="$Workflow.DoRollback()">
        <c:Image/>
        <c:TextView Text="#sku#"/>
      </c:HorizontalLayout>
      <c:Button Id="btnForward" Text="#forward#" CssClass="btn_forward" OnEvent="Forward" OnClickAction="$Workflow.DoForward()"/>
      <c:TextView Text="#order#" />
    </c:DockLayout>

    <c:Image CssClass="5_scroll"></c:Image>
    <c:HorizontalLine/>

    <s:If Test="$workflow.order.IsNew == True">

      <s:If Test="$workflow.order.PriceListAsRef != null">
        <c:HorizontalLayout CssClass="bottom_btn" OnEvent="Back" OnClickAction="$Workflow.DoAction(Add,$workflow.order)">
          <c:TextView Text="#add#"></c:TextView>
        </c:HorizontalLayout>
        <c:HorizontalLine CssClass="b_line"/>
      </s:If>

      <c:ScrollView Id="grScrollView">

        <c:HorizontalLayout Id="Orderadd" CssClass="caption_grid">
          <c:TextView Text="#orderInfo#:"></c:TextView>
        </c:HorizontalLayout>
        <c:HorizontalLine/>

        <c:HorizontalLayout CssClass ="grid" OnClickAction="$Workflow.DoAction(ShowInfo,$sum)">
          <c:VerticalLayout>
            <c:TextView Text="#priceList#: {$workflow.order.PriceListAsObject.Description}" CssClass="description_row"></c:TextView>
            <c:TextView Text="#orderSum#:" CssClass="description_row"></c:TextView>
            <c:TextView Text="$sum" CssClass="main_row"></c:TextView>
          </c:VerticalLayout>
          <c:Image/>
        </c:HorizontalLayout>
        <c:HorizontalLine/>

        <c:HorizontalLayout CssClass="caption_grid">
          <c:TextView Text="#skuInOrder#:"></c:TextView>
        </c:HorizontalLayout>
        <c:HorizontalLine/>

        <s:Iterator Id="orderitem" Value="$items">
          <s:Push Id="orderitem" Value="$Facade.DeleteZeroItem($orderitem)"></s:Push>

          <s:If Test="$orderitem != null">
            <c:HorizontalLayout CssClass ="grid" OnClickAction="$Workflow.DoAction(Edit,$orderitem.SKUAsObject,null,$orderitem)">
              <c:VerticalLayout>
                <s:Push Id="featureDescr" Value="$Facade.GetFeatureDescr($orderitem.FeatureAsObject)"></s:Push>
                <c:TextView Text="{$orderitem.SKUAsObject.Description}{$featureDescr}" CssClass="main_row"></c:TextView>
                <s:Push Value="$Facade.GetSKUAmount($workflow.order.Id, $orderitem)" Id="amount"/>
                <c:TextView Text="#quantity#: {$orderitem.Qty}   #amount#: {$amount}" CssClass="description_row"></c:TextView>
              </c:VerticalLayout>
              <c:Image/>
            </c:HorizontalLayout>
            <c:HorizontalLine/>
          </s:If>

        </s:Iterator>

      </c:ScrollView>
    </s:If>




    <s:Else>
      <c:HorizontalLayout CssClass ="grid" OnClickAction="$Workflow.DoAction(ShowInfo,$sum)">
        <c:VerticalLayout>
          <c:TextView Text="#priceList#: {$workflow.order.PriceListAsObject.Description}" CssClass="description_row"></c:TextView>
          <c:TextView Text="#orderSum#:" CssClass="description_row"></c:TextView>
          <c:TextView Text="$sum" CssClass="main_row"></c:TextView>
        </c:VerticalLayout>
        <c:Image/>
      </c:HorizontalLayout>
      <c:HorizontalLine/>


      <c:ScrollView Id="grScrollView" CssClass="grid">

        <s:Iterator Id="orderitem" Value="$items">

          <c:HorizontalLayout>
            <c:VerticalLayout>
              <c:TextView Text="$orderitem.SKUAsObject.Description" CssClass="main_row"></c:TextView>
              <s:Push Value="$Facade.GetSKUAmount($workflow.order.Id, $orderitem)" Id="amount"/>
              <c:TextView Text="#quantity#: {$orderitem.Qty}   #amount#: {$amount}" CssClass="description_row"></c:TextView>
            </c:VerticalLayout>
          </c:HorizontalLayout>
          <c:HorizontalLine/>

        </s:Iterator>

      </c:ScrollView>

    </s:Else>

  </c:DockLayout>

</c:Screen>